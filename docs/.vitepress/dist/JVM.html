<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>☕ JVM 核心知识 | Bagu for me and for all</title>
    <meta name="description" content="We need bagu to get a f**king job!">
    <meta name="generator" content="VitePress v2.0.0-alpha.15">
    <link rel="preload stylesheet" href="/bagu/assets/style.Cpgg9TW0.css" as="style">
    <link rel="preload stylesheet" href="/bagu/vp-icons.css" as="style">
    
    <script type="module" src="/bagu/assets/app.BHe_nXvt.js"></script>
    <link rel="preload" href="/bagu/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/bagu/assets/chunks/theme.X3c_qVn7.js">
    <link rel="modulepreload" href="/bagu/assets/chunks/framework.BZD6ashX.js">
    <link rel="modulepreload" href="/bagu/assets/JVM.md.Dw5KLLW8.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-1df9f90f><!--[--><!--]--><!--[--><span tabindex="-1" data-v-331ec75c></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-331ec75c>Skip to content</a><!--]--><!----><header class="VPNav" data-v-1df9f90f data-v-da52a441><div class="VPNavBar" data-v-da52a441 data-v-70946a35><div class="wrapper" data-v-70946a35><div class="container" data-v-70946a35><div class="title" data-v-70946a35><div class="VPNavBarTitle" data-v-70946a35 data-v-1e38c6bc><a class="title" href="/bagu/" data-v-1e38c6bc><!--[--><!--]--><!----><span data-v-1e38c6bc>Bagu for me and for all</span><!--[--><!--]--></a></div></div><div class="content" data-v-70946a35><div class="content-body" data-v-70946a35><!--[--><!--]--><div class="VPNavBarSearch search" data-v-70946a35><!--[--><!----><div id="local-search"><button type="button" aria-label="Search" aria-keyshortcuts="/ control+k meta+k" class="DocSearch DocSearch-Button"><span class="DocSearch-Button-Container"><span class="vpi-search DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key"></kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-70946a35 data-v-39714824><span id="main-nav-aria-label" class="visually-hidden" data-v-39714824> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/bagu/" tabindex="0" data-v-39714824 data-v-52a1d768><!--[--><span data-v-52a1d768>Home</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/bagu/Java%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%9F%BA%E7%A1%80.html" tabindex="0" data-v-39714824 data-v-52a1d768><!--[--><span data-v-52a1d768>JDK与数据结构</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/bagu/%E6%95%B0%E6%8D%AE%E5%BA%93.html" tabindex="0" data-v-39714824 data-v-52a1d768><!--[--><span data-v-52a1d768>数据库</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/bagu/Elasticsearch.html" tabindex="0" data-v-39714824 data-v-52a1d768><!--[--><span data-v-52a1d768>Elasticsearch</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/bagu/LLM%E4%B8%8EAgent.html" tabindex="0" data-v-39714824 data-v-52a1d768><!--[--><span data-v-52a1d768>LLM与Agent</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/bagu/Spring.html" tabindex="0" data-v-39714824 data-v-52a1d768><!--[--><span data-v-52a1d768>Spring</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/bagu/JVM.html" tabindex="0" data-v-39714824 data-v-52a1d768><!--[--><span data-v-52a1d768>JVM与性能调优</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/bagu/%E9%AB%98%E6%80%A7%E8%83%BDRedis.html" tabindex="0" data-v-39714824 data-v-52a1d768><!--[--><span data-v-52a1d768>高性能Redis</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/bagu/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97.html" tabindex="0" data-v-39714824 data-v-52a1d768><!--[--><span data-v-52a1d768>消息队列</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-70946a35 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-70946a35 data-v-0394ad82 data-v-d07f11e6><!--[--><a class="VPSocialLink no-icon" href="https://github.com/l0sgAi" aria-label="github" target="_blank" rel="me noopener" data-v-d07f11e6 data-v-591a6b30><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-70946a35 data-v-bf2fac68 data-v-42cb505d><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-42cb505d><span class="vpi-more-horizontal icon" data-v-42cb505d></span></button><div class="menu" data-v-42cb505d><div class="VPMenu" data-v-42cb505d data-v-25a6cce8><!----><!--[--><!--[--><!----><div class="group" data-v-bf2fac68><div class="item appearance" data-v-bf2fac68><p class="label" data-v-bf2fac68>Appearance</p><div class="appearance-action" data-v-bf2fac68><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bf2fac68 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><div class="group" data-v-bf2fac68><div class="item social-links" data-v-bf2fac68><div class="VPSocialLinks social-links-list" data-v-bf2fac68 data-v-d07f11e6><!--[--><a class="VPSocialLink no-icon" href="https://github.com/l0sgAi" aria-label="github" target="_blank" rel="me noopener" data-v-d07f11e6 data-v-591a6b30><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-70946a35 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-70946a35><div class="divider-line" data-v-70946a35></div></div></div><!----></header><div class="VPLocalNav empty fixed" data-v-1df9f90f data-v-db738f89><div class="container" data-v-db738f89><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-db738f89 data-v-0bf0e06f><button data-v-0bf0e06f>Return to top</button><!----></div></div></div><!----><div class="VPContent" id="VPContent" data-v-1df9f90f data-v-c87f25bf><div class="VPDoc has-aside" data-v-c87f25bf data-v-7011f0d8><!--[--><!--]--><div class="container" data-v-7011f0d8><div class="aside" data-v-7011f0d8><div class="aside-curtain" data-v-7011f0d8></div><div class="aside-container" data-v-7011f0d8><div class="aside-content" data-v-7011f0d8><div class="VPDocAside" data-v-7011f0d8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-60d5052e><div class="content" data-v-60d5052e><div class="outline-marker" data-v-60d5052e></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-60d5052e>On this page</div><ul class="VPDocOutlineItem root" data-v-60d5052e data-v-1ce71065><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-7011f0d8><div class="content-container" data-v-7011f0d8><!--[--><!--]--><main class="main" data-v-7011f0d8><div style="position:relative;" class="vp-doc _bagu_JVM" data-v-7011f0d8><div><h1 id="☕-jvm-核心知识" tabindex="-1">☕ JVM 核心知识 <a class="header-anchor" href="#☕-jvm-核心知识" aria-label="Permalink to “☕ JVM 核心知识”">​</a></h1><hr><h1 id="i-内存模型-runtime-data-areas" tabindex="-1">I. 内存模型 (Runtime Data Areas) <a class="header-anchor" href="#i-内存模型-runtime-data-areas" aria-label="Permalink to “I. 内存模型 (Runtime Data Areas)”">​</a></h1><h3 id="_1-区域划分" tabindex="-1">1. 区域划分 <a class="header-anchor" href="#_1-区域划分" aria-label="Permalink to “1. 区域划分”">​</a></h3><p>JVM 在执行 Java 程序的过程中会把它所管理的内存划分为若干个不同的数据区域：</p><ul><li><p><strong>线程私有</strong>：</p><ul><li><strong>程序计数器 (Program Counter Register)</strong>：当前线程所执行的字节码的行号指示器，是唯一一个不会出现 OOM 的区域.</li><li><strong>虚拟机栈 (VM Stack)</strong>：描述 Java 方法执行的内存模型，每个方法执行时都会创建一个栈帧用于存储局部变量表、操作数栈、动态链接、方法出口等信息.</li><li><strong>本地方法栈 (Native Method Stack)</strong>：与虚拟机栈类似，不过是为 Native 方法服务.</li></ul></li><li><p><strong>线程共享</strong>：</p><ul><li><strong>堆 (Heap)</strong>：JVM 管理的最大一块内存，存放对象实例，是 GC 的主要区域.</li><li><strong>方法区 (Method Area)</strong>：存储已被虚拟机加载的类信息、常量、静态变量、即时编译器编译后的代码等数据 (JDK 8 后由元空间 Metaspace 实现，使用本地内存).</li></ul></li></ul><h3 id="_2-堆内存分布" tabindex="-1">2. 堆内存分布 <a class="header-anchor" href="#_2-堆内存分布" aria-label="Permalink to “2. 堆内存分布”">​</a></h3><ul><li><strong>新生代 (Young Generation)</strong>： <ul><li><strong>Eden 区</strong>：新对象主要分配在 Eden 区.</li><li><strong>Survivor 区 (S0, S1)</strong>：存活对象在 S0/S1 之间复制，默认比例 Eden:S0:S1 = 8:1:1.</li></ul></li><li><strong>老年代 (Old Generation)</strong>：存放生命周期较长的对象.</li></ul><hr><h1 id="ii-垃圾回收-gc" tabindex="-1">II. 垃圾回收 (GC) <a class="header-anchor" href="#ii-垃圾回收-gc" aria-label="Permalink to “II. 垃圾回收 (GC)”">​</a></h1><h3 id="_1-如何判断对象已死" tabindex="-1">1. 如何判断对象已死？ <a class="header-anchor" href="#_1-如何判断对象已死" aria-label="Permalink to “1. 如何判断对象已死？”">​</a></h3><ul><li><strong>引用计数法</strong>：对象被引用一次加1，引用失效减1。无法解决循环引用问题.</li><li><strong>可达性分析算法</strong> (主流)：从 GC Roots (如栈中引用的对象、静态变量引用的对象) 出发，通过引用链向下搜索，不可达的对象即可回收.</li></ul><h3 id="_2-常见的-gc-算法" tabindex="-1">2. 常见的 GC 算法 <a class="header-anchor" href="#_2-常见的-gc-算法" aria-label="Permalink to “2. 常见的 GC 算法”">​</a></h3><ul><li><strong>标记-清除 (Mark-Sweep)</strong>：标记出所有需要回收的对象，统一回收。缺点：内存碎片.</li><li><strong>标记-复制 (Mark-Copy)</strong>：将内存分为两块，每次只用一块，将存活对象复制到另一块。优点：无碎片；缺点：内存利用率低 (用于新生代).</li><li><strong>标记-整理 (Mark-Compact)</strong>：标记存活对象，将其向一端移动，清理掉边界以外的内存。优点：无碎片 (用于老年代).</li></ul><h3 id="_3-说明一下-cms-和-g1" tabindex="-1">3. 说明一下 CMS 和 G1 <a class="header-anchor" href="#_3-说明一下-cms-和-g1" aria-label="Permalink to “3. 说明一下 CMS 和 G1”">​</a></h3><ul><li><p><strong>CMS (Concurrent Mark Sweep)</strong>：</p><ul><li>以获取<strong>最短回收停顿时间</strong>为目标.</li><li>基于“标记-清除”算法.</li><li>过程：初始标记(STW) -&gt; 并发标记 -&gt; 重新标记(STW) -&gt; 并发清除.</li><li>缺点：对 CPU 敏感、产生内存碎片.</li></ul></li><li><p><strong>G1 (Garbage First)</strong>：</p><ul><li>面向服务端应用，<strong>可预测停顿</strong>.</li><li>将堆划分为多个大小相等的 Region.</li><li>整体看是“标记-整理”，局部看是“标记-复制”，不会产生内存碎片.</li><li>适合大内存机器，JDK 9 默认收集器.</li></ul></li></ul><hr><h1 id="iii-类加载机制" tabindex="-1">III. 类加载机制 <a class="header-anchor" href="#iii-类加载机制" aria-label="Permalink to “III. 类加载机制”">​</a></h1><h3 id="_1-类加载过程" tabindex="-1">1. 类加载过程 <a class="header-anchor" href="#_1-类加载过程" aria-label="Permalink to “1. 类加载过程”">​</a></h3><ol><li><strong>加载 (Loading)</strong>：通过全类名获取二进制字节流，将静态存储结构转化为方法区的运行时数据结构.</li><li><strong>链接 (Linking)</strong>： <ul><li><strong>验证</strong>：确保字节码符合规范.</li><li><strong>准备</strong>：为静态变量分配内存并设置零值.</li><li><strong>解析</strong>：将常量池内的符号引用替换为直接引用.</li></ul></li><li><strong>初始化 (Initialization)</strong>：执行类构造器 <code>&lt;clinit&gt;</code> 方法 (静态代码块赋值).</li></ol><h3 id="_2-双亲委派模型-dual-parent-delegation" tabindex="-1">2. 双亲委派模型 (Dual Parent Delegation) <a class="header-anchor" href="#_2-双亲委派模型-dual-parent-delegation" aria-label="Permalink to “2. 双亲委派模型 (Dual Parent Delegation)”">​</a></h3><ul><li><strong>定义</strong>：当一个类加载器收到类加载请求时，首先委托给父类加载器去完成，父加载器无法加载时才自己尝试加载.</li><li><strong>好处</strong>：保证核心类库 (如 <code>java.lang.Object</code>) 的安全性，避免用户自定义类覆盖核心类.</li><li><strong>打破场景</strong>：JDBC (通过 SPI 机制)、Tomcat (Web 应用隔离).</li></ul><hr><h1 id="iv-常见-jvm-参数与排查" tabindex="-1">IV. 常见 JVM 参数与排查 <a class="header-anchor" href="#iv-常见-jvm-参数与排查" aria-label="Permalink to “IV. 常见 JVM 参数与排查”">​</a></h1><h3 id="_1-常用参数" tabindex="-1">1. 常用参数 <a class="header-anchor" href="#_1-常用参数" aria-label="Permalink to “1. 常用参数”">​</a></h3><ul><li><code>-Xms</code> / <code>-Xmx</code>：设置堆的初始大小和最大大小 (通常设置为相同，避免动态扩容抖动).</li><li><code>-Xmn</code>：设置新生代大小.</li><li><code>-XX:MetaspaceSize</code>：设置元空间初始大小.</li><li><code>-XX:+PrintGCDetails</code>：打印 GC 详细日志.</li><li><code>-XX:+HeapDumpOnOutOfMemoryError</code>：OOM 时自动 Dump 堆内存.</li></ul><h3 id="_2-线上排查工具" tabindex="-1">2. 线上排查工具 <a class="header-anchor" href="#_2-线上排查工具" aria-label="Permalink to “2. 线上排查工具”">​</a></h3><ul><li><code>jps</code>：查看 Java 进程状态.</li><li><code>jstat</code>：监视虚拟机各种运行状态信息 (GC 情况等).</li><li><code>jinfo</code>：实时查看和调整虚拟机各项参数.</li><li><code>jmap</code>：生成堆转储快照 (dump 文件).</li><li><code>jstack</code>：生成虚拟机当前时刻的线程快照 (排查死锁、CPU 飙高).</li><li><strong>Arthas</strong>：阿里开源的 Java 诊断工具 (推荐).</li></ul></div></div></main><footer class="VPDocFooter" data-v-7011f0d8 data-v-e257564d><!--[--><!--]--><!----><!----></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"api-examples.md\":\"DdeUUmLM\",\"elasticsearch.md\":\"Co7woVhU\",\"index.md\":\"BJepNdkD\",\"java与数据结构基础.md\":\"CiLlqZFp\",\"jvm.md\":\"Dw5KLLW8\",\"llm与agent.md\":\"0Saw8V-N\",\"markdown-examples.md\":\"CIl-LM3l\",\"spring.md\":\"I8k0JqHu\",\"场景题-点赞系统设计.md\":\"q-DaUAga\",\"场景题-评论缓存设计.md\":\"KYsG2qBi\",\"数据库.md\":\"BOFkCrXm\",\"消息队列.md\":\"BMCSJmon\",\"高性能redis.md\":\"BQpWY_zH\",\"高性能弹幕系统.md\":\"BZfkal9d\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Bagu for me and for all\",\"description\":\"We need bagu to get a f**king job!\",\"base\":\"/bagu/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"JDK与数据结构\",\"link\":\"/Java与数据结构基础\"},{\"text\":\"数据库\",\"link\":\"/数据库\"},{\"text\":\"Elasticsearch\",\"link\":\"/Elasticsearch\"},{\"text\":\"LLM与Agent\",\"link\":\"/LLM与Agent\"},{\"text\":\"Spring\",\"link\":\"/Spring\"},{\"text\":\"JVM与性能调优\",\"link\":\"/JVM\"},{\"text\":\"高性能Redis\",\"link\":\"/高性能Redis\"},{\"text\":\"消息队列\",\"link\":\"/消息队列\"}],\"search\":{\"provider\":\"local\"},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/l0sgAi\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false,\"additionalConfig\":{}}");</script>
    
  </body>
</html>